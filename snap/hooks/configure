#!/bin/bash
set -e
snapctl stop "$SNAP_INSTANCE_NAME"

echo "Getting configuration value for 'port'"
output=$(snapctl get port)
if [ -z $output ]; then
	echo "No value for port, resetting to default"
    snapctl set port=8000
fi

echo "Getting configuration value for 'ip-address'"
output=$(snapctl get ip-address)
if [ -z $output ]; then
	echo "No value for ip-address, resetting to default"
    snapctl set ip-address=127.0.0.1
fi

echo "Getting configuration value for 'log-level'"
output=$(snapctl get log-level)
if [ -z $output ]; then
	echo "No value for log-level, resetting to default"
    snapctl set log-level=info
fi

echo "Getting configuration value for 'ctx-size'"
output=$(snapctl get ctx-size)
if [ -z $output ]; then
	echo "No value for ctx-size, resetting to default"
    snapctl set ctx-size=4096
fi
echo "Getting configuration value for 'llamacpp-args'"
output=$(snapctl get llamacpp-args)
if [ -z $output ]; then
	echo "No value for llamacpp-args, resetting to default"
    snapctl set llamacpp-args=""
fi

snapctl start "$SNAP_INSTANCE_NAME"
